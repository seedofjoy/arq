language: python

cache: pip

services:
- redis-server

dist: bionic

python:
  - '3.6'
  - '3.7'
  - '3.8'
  - '3.9-dev'

matrix:
  allow_failures:
  - python: 3.9-dev

install:
- make install

script:
- make lint
- make test
- make docs
- ./tests/check_tag.py

after_success:
- ls -lha
- bash <(curl -s https://codecov.io/bash)

deploy:
- provider: pypi
  user: __token__
  distributions: sdist bdist_wheel
  on:
    tags: true
    python: 3.7
    condition: $TRAVIS_TAG =~ ^v[0-9]+\.[0-9]+\.[0-9]+
# - provider: script
#   script: make deploy-docs
#   on:
#     tags: true
#     python: 3.7
#     condition: $TRAVIS_TAG =~ ^v[0-9]+\.[0-9]+\.[0-9]+
